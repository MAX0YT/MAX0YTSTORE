import{initializeApp as E}from"https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";import{getDatabase as v,ref as T,get as f,child as q}from"https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";import{getAuth as x,createUserWithEmailAndPassword as b,signInWithEmailAndPassword as m,signOut as r,onAuthStateChanged as s,updateProfile as k}from"https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";var C={apiKey:"AIzaSyCUltMwgKS1GOH5sL46f5l0Z9oi6qI2aTI",authDomain:"max0ytst.firebaseapp.com",databaseURL:"https://max0ytst-default-rtdb.firebaseio.com",projectId:"max0ytst",storageBucket:"max0ytst.firebasestorage.app",messagingSenderId:"896428844125",appId:"1:896428844125:web:7a7bed5bfe578785ff59b4",measurementId:"G-G0RDKQBW80"},l=E(C),G=v(l),n=x(l);class i{constructor(){this.currentUser=null,this.init()}init(){s(n,(e)=>{if(this.currentUser=e,this.updateUI(),e&&window.location.pathname.includes("Authorization.html"))window.location.href="/index.html"})}async login(e,t){try{return{success:!0,user:(await m(n,e,t)).user}}catch(c){return{success:!1,error:c.message}}}async logout(){try{return await r(n),window.location.href="/index.html",{success:!0}}catch(e){return{success:!1,error:e.message}}}updateUI(){let e=document.querySelector('a[href="/HTML/Authorization.html"]');if(this.currentUser){if(e)e.innerHTML=`
                    <button type="button" class="hover:text-viol text-yell bg-viol hover:bg-yell focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-4 py-2 text-center">
                        ${this.currentUser.email}
                    </button>
                `,e.href="/HTML/Profile.html",this.addLogoutButton()}}addLogoutButton(){if(document.getElementById("logout-btn"))return;let e=document.getElementById("loginDiv");if(e){let t=document.createElement("button");t.id="logout-btn",t.className="ml-2 hover:text-viol text-yell bg-red-600 hover:bg-red-700 font-medium rounded-lg text-sm px-4 py-2 text-center ml-2",t.textContent="Выйти",t.onclick=()=>this.logout(),e.appendChild(t)}}}var y=new i;class L{constructor(){this.init()}init(){let e=document.getElementById("login-form");if(e)e.addEventListener("submit",(t)=>{t.preventDefault(),this.handleLogin()})}async handleLogin(){let e=document.getElementById("email").value,t=document.getElementById("password").value,c=document.querySelector('button[type="submit"]'),d=c.textContent;c.textContent="Вход...",c.disabled=!0;try{let o=await y.login(e,t);if(o.success);else this.showError(o.error)}catch(o){this.showError("Произошла ошибка при входе")}finally{c.textContent=d,c.disabled=!1}}showError(e){let t=document.getElementById("error-message");if(t)t.textContent=e,t.classList.remove("hidden"),setTimeout(()=>{t.classList.add("hidden")},5000)}}document.addEventListener("DOMContentLoaded",()=>{new L});
